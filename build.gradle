apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'maven'

project.version = '1.0.3-SNAPSHOT'
project.group = 'de.prob'


repositories {
	mavenCentral()
   	mavenRepo name: 'cobra_ext', url: "http://cobra.cs.uni-duesseldorf.de/artifactory/repo"
}

dependencies {
    compile (group: 'de.stups', name: 'tla', version: '1.0.9-SNAPSHOT')
	testCompile (group: 'de.prob', name: 'prologlib', version: '2.4.2-SNAPSHOT')
 	testCompile (group: 'de.prob', name: 'parserbase', version: '2.4.2-SNAPSHOT')
  	testCompile (group: 'de.prob', name: 'bparser', version: '2.4.2-SNAPSHOT')
	testCompile (group: 'junit', name: 'junit', version: '4.+')
}

jar {
	from sourceSets.main.allJava
 }


task pack(type: Jar, dependsOn: [jar]) {
	baseName = 'TLA2B'
	deps = configurations.runtime + configurations.archives.allArtifacts.getFiles()
		depClasses = {
		deps.collect {
			it.isDirectory() ? it : zipTree(it)
		}
	}
	from(depClasses) {
		exclude 'META-INF/MANIFEST.MF'
	}
	manifest { attributes 'Main-Class': 'translation.TLA2B' }

	doLast{
		println "Created archive: "+archivePath
	}
}

task copy(dependsOn: pack) << {
	copy {
   from('build/libs/') { include 'TLA2B-'+project.version+'.jar' }
   into 'build/tla2b'
   rename '(TLA2B)-(.+)', '$1.jar'
}
copy {
   from('src/main/resources/') { include '**/*' }
   into 'build/tla2b'
}}


task deploy(type: Zip, dependsOn: copy) {
   from('build/') { include 'tla2b/**' }
   baseName = 'tla2b'
}


